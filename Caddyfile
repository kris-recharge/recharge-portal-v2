dashboard.rechargealaska.net {

  encode gzip

  # --- Next.js (UI + auth + api) ---
  handle /login* {
    reverse_proxy web:3000
  }

  handle /api/* {
    reverse_proxy web:3000
  }

  # /app is now a Next.js route (not Streamlit)
  handle /app* {
    reverse_proxy web:3000
  }

  # --- Streamlit behind auth, mounted at /st ---
  handle /st* {
    forward_auth web:3000 {
      uri /api/auth/verify
      copy_headers Cookie
    }
    reverse_proxy app:8501
  }

  # Streamlitâ€™s static assets also need auth
  handle /_stcore/* {
    forward_auth web:3000 {
      uri /api/auth/verify
      copy_headers Cookie
    }
    reverse_proxy app:8501
  }

  # Root goes to Next.js (your Next / page can redirect to /app)
  handle {
    reverse_proxy web:3000
  }
}
